<!DOCTYPE html>
<html>
<head>
<title>Maps API Examples</title>
<style type="text/css">

#map {
	width: 550px;
	height: 300px;
	border: 1px solid black;
}

</style>
</head>
<body>

<div id="map"></div>
<BR>
<input type="button" value="Toggle Watershed" onclick="toggle()"> <input type="button" value="Toggle Rainlayer" onclick="toggle_rain()">

<script type="text/javascript">

window.onload = createmap;

var map, infowindow, watershed, rainlayer;

function toggle_rain(){
	if (rainlayer.getOpacity(1)) {
		rainlayer.setOpacity(0);
	} else {
		rainlayer.setOpacity(1);		
	}
}

function toggle(){
	if (watershed.getVisible())
		watershed.setVisible(false);
	else
		watershed.setVisible(true);		
}

function createmap() {

	// define a spatial point
	var point = {lat: 42.2, lng: -93};
	var mapelement = document.getElementById('map');

	// create map
	map = new google.maps.Map(
		mapelement,
		{
			center: point,
			streetViewControl: false,
			scaleControl: true,
			zoom: 6
		}
	);


	infowindow = new google.maps.InfoWindow();

	// infowindow.setContent('Hello World!');
	// infowindow.setPosition(point);
	// infowindow.open(map);

	var markericon = 'beachflag.png';

	// create a marker
	var marker = new google.maps.Marker({
		position: point,
		map: map,
		icon: markericon,
		title: 'Sensor 101'
	});

    // marker click
    marker.addListener('click', function() {   
      infowindow.setContent('Marker Clicked - Metadata');
      infowindow.open(map, marker);
    });

    var tempmarker;
    for (var i = 0; i < 100; i++) {
    	var dx = Math.random()*4.5;
    	var dy = Math.random()*2.5;
    	point = {lat: 40.5+dy, lng: -95.5+dx};
		tempmarker = new google.maps.Marker({
			position: point,
			map: map,
			icon: markericon,
			title: 'Sensor '+(i+100)
		});
	    tempmarker.addListener('click', function() {   
	      infowindow.setContent('Sensor ID: '+this.title+"<BR>City: ....<BR>River: ....");
	      infowindow.open(map, this);
	    });
    }

    // create a polygon
	var path = [];
	path[0] = {lat: 41, lng: -93};
	path[1] = {lat: 42.5, lng: -92.5};
	path[2] = {lat: 42, lng: -91.5};
	path[3] = {lat: 41.5, lng: -91};
	path[4] = {lat: 41.5, lng: -92};
	//path[5] = {lat: 41, lng: -93};

	watershed = new google.maps.Polygon({
		path: path,
		fillColor: '#0F0',
		draggable: true,
		editable: true,
		fillOpacity: 0.3
	});
	watershed.setMap(map);


	var polyline = new google.maps.Polyline({
		path: path,
		strokeColor: '#F00',
		strokeOpacity: 1.0,
		strokeWeight: 2.0
	});
	//polyline.setMap(map);


	var circle = new google.maps.Circle({
		center: point,
		radius: 30000,
		fillColor: '#00F',
		fillOpacity: 0.3,
		map: map
	});



	// RECTANGLE
	var path = {
        north: 42.685,
        south: 41.671,
        east: -92.234,
        west: -93.251
      };
    var rectangle = new google.maps.Rectangle({
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.35,
      map: map,
      bounds: path
    });



	// image overlay on the map
	var rainimage = 'https://s-iihr77.iihr.uiowa.edu/Animation/Cumulative/Accu14.gif';
	var rainbounds = {
		north: 44,
		south: 40,
		east: -90,
		west: -97
	}
    var rectangle = new google.maps.Rectangle({
      strokeColor: '#000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillOpacity: 0.0,
      map: map,
      bounds: rainbounds
    });

	rainlayer = new google.maps.GroundOverlay(rainimage, rainbounds);
	rainlayer.setMap(map);
	rainlayer.setOpacity(1);


	// KML / KMZ Layer
	var url = 'https://ifis.iowafloodcenter.org/ifis/layers/more/iowa_huc8.kmz';
    var kmzLayer = new google.maps.KmlLayer({
		url: url,
		map: map
    });


	// GEORSS DATA feed layer overlay
	url = 'http://api.flickr.com/services/feeds/geo/?g=322338@N20&lang=en-us&format=feed-georss';
	var georssLayer = new google.maps.KmlLayer({
		url: url
	});
	georssLayer.setMap(map);


    // GEOJSON example
    var url = 'ia_counties.geojson'; // works
    map.data.loadGeoJson(url);
    
    // Set the stroke width, and fill color
    map.data.setStyle({
		fillColor: 'green',
		strokeWeight: 1
    });
    

}

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNCNBr9PSfJ-yTPA63yQVU-Oh7ZJ9MXPk" async defer></script>
</body>
</html>